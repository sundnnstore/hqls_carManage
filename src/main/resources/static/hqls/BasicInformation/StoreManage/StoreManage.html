<link rel="stylesheet" type="text/css" href="BasicInformation/StoreManage/StoreManage.css" />
<div class="store">
    门店管理
    <!-- 门店信息搜索 && 添加门店 -->
    <div class="head ">
        <div class="layui-input-inline">
            <label for="first_title" class="layui-form-label">门店名称</label>
            <div class="layui-input-block">
                <input type="text" name="storeName" id="storeName" class="layui-input" />
            </div>
        </div>
        <div class="layui-input-inline">
            <label for="" class="layui-form-label">联系人</label>
            <div class="layui-input-block">
                <input type="text" name="userName" id="userName" class="layui-input" />
            </div>
        </div>
        <div class="layui-input-inline">
            <label for="" class="layui-form-label">联系人号码</label>
            <div class="layui-input-block">
                <input type="text" name="userMobile" id="userMobile" class="layui-input" />
            </div>
        </div>
        <div class="layui-input-inline">
            <label for="" class="layui-form-label">地址</label>
            <div class="layui-input-block">
                <div class="layui-input-inline">
                    <select name="prov" id="province" onchange="getCitys(this)" class="layui-select">
                        
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="city" id="city" onchange="getCountys(this)" class="layui-select">
                        <option value="">请选择市</option>
                        
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="area" id="county" class="layui-select">
                        <option value="">请选择县/区</option>
                    </select>
                </div>
            </div>
        </div>
        <button id="searchStore" class="layui-btn" onclick="findStore()">搜索</button>
        <button id="addStore" class="layui-btn" onclick="addStore()">新增</button>
    </div>
    <!-- 门店信息展示 -->
    <div class="content">
        <div class="tableContainer">
            <table class="layui-table">
                <thead>
                    <tr>
                        <th>门店名称</th>
                        <th>联系人</th>
                        <th>联系人号码</th>
                        <th>门店地址</th>
                        <th>门店位置</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="store_tb">
                    <!-- <tr>
                        <td>华汽总部</td>
                        <td>江苏省公司</td>
                        <td>南京新街口店</td>
                        <td>新华大夏9527层第7区</td>
                        <td>283:303:303</td>
                        <td class="operation">
                            <a id="view" data-method="view">查看</a>
                            <a id="edit" data-method="edit">编辑</a>
                            <a id="isEnable" data-method="isEnable">启用</a>
                        </td>
                    </tr>
                    <tr>
                        <td>华汽总部</td>
                        <td>江苏省公司</td>
                        <td>南京新街口店</td>
                        <td>新华大夏9527层第7区</td>
                        <td>283:303:303</td>
                        <td class="operation">
                            <a id="view" data-method="view">查看</a>
                            <a id="edit" data-method="edit">编辑</a>
                            <a id="isEnable" data-method="isEnable" >启用</a>
                        </td>
                    </tr> -->
                </tbody>
            </table>
        </div>
    </div>
</div>
 <script type="text/javascript">
 
 var pros = findAllProvinces();
 var p = null;
 var provinces = '<option value="">请选择省</option>';
 for(i=0;i<pros.length;i++){
	 p= pros[i];
	 provinces += '<option value="'+p.id+'">'+p.name+'</option>';
 }
 $("#province").html(provinces);
 

 function getCitys(obj){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择市</option>';
 	 for(i=0;i<citys.length;i++){
 		 var  c = citys[i];
 		 ci += '<option value="'+c.id+'">'+c.name+'</option>';
 	 }
 	 $("#city").html(ci);
 }

 function getCountys(obj){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择县</option>';
 	 for(i=0;i<citys.length;i++){
 		var cs = citys[i];
 		 ci += '<option value="'+cs.id+'">'+cs.name+'</option>';
 	 }
 	 $("#county").html(ci);
 }
	function findStore(){
		$.ajax({
    	url : "http://localhost:8881/findstoreinfo",
		type : "post",
		data : { "storeName":$("#storeName").val(),"userName":$("#userName").val(),
				 "userMobile":$("#userMobile").val(), 
				 "provinceId":$("#province").val(),
				 "cityId":$("#city").val(),
				 "countyId":$("#county").val(), 
				 "pageIndex":1,
				 "pageSize":5},
				
		
    	success : function(data){
    		var list = data.result;
    		var tb_html="";
    		var store_tb = $("#store_tb");
    		for(i=0;i<list.length;i++){
    			var tr_html=list[i];
    			var status = "启用";
    			if(tr_html.isUseable){
    				status = "禁用";
    			}
    			tb_html += '<tr><td>'+tr_html.storeName+'</td>'+
    						'<td>'+tr_html.userName+'</td>'+
    						'<td>'+tr_html.mobile+'</td>'+
    						'<td>'+tr_html.address+'</td>'+
    						'<td>('+tr_html.longitude+','+tr_html.latitude+')</td>'+
    						'<td>'+
    						'<a data-method="view">查看</a> '+
    						'<a data-method="edit">编辑</a> '+
    						'<a data-method="idEnable" onclick="isEnable('+tr_html.storeId+')">'+status+'</a> '+
    						'</td></tr>'
    				
    		}
    			store_tb.html(tb_html);
    		
    		}
    		
    }); 
}
	
	
	function isEnable(storeId){
		$.ajax({
	    	url : "http://localhost:8881/storeisuseable",
			type : "post",
			data : {"storeId":storeId},
	    	success : function(data){
	    		 window.location.reload();
	    			
	    		}
	    }); 
	}

	
</script> 
<script src="BasicInformation/StoreManage/StoreManage.js"></script>