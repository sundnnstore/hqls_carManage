<link rel="stylesheet" type="text/css" href="BasicInformation/StoreManage/StoreManage.css" />
<div class="store">
    门店管理
    <!-- 门店信息搜索 && 添加门店 -->
    <div class="head ">
        <div class="layui-input-inline">
            <label for="first_title" class="layui-form-label">门店名称</label>
            <div class="layui-input-block">
                <input type="text" name="storeName" id="storeName" class="layui-input" />
            </div>
        </div>
        <div class="layui-input-inline">
            <label for="" class="layui-form-label">联系人</label>
            <div class="layui-input-block">
                <input type="text" name="userName" id="userName" class="layui-input" />
            </div>
        </div>
        <div class="layui-input-inline">
            <label for="" class="layui-form-label">联系人号码</label>
            <div class="layui-input-block">
                <input type="text" name="userMobile" id="userMobile" class="layui-input"  onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9-]+/,'');}).call(this)"/>
            </div>
        </div>
        <div class="layui-input-inline">
            <label for="" class="layui-form-label">地址</label>
            <div class="layui-input-block">
                <div class="layui-input-inline">
                    <select name="prov" id="province" onchange="getCitys(this)" class="layui-select">
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="city" id="city" onchange="getCountys(this)" class="layui-select">
                        <option value="">请选择市</option>
                        
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="area" id="county" class="layui-select">
                        <option value="">请选择县/区</option>
                    </select>
                </div>
            </div>
        </div>
        <button id="searchStore" class="layui-btn" >搜索</button>
        <button id="addStore" class="layui-btn layui-btn-normal" onclick="addStore()" data-method="addStore">新增</button>
        
    </div>
    <!-- 门店信息展示 -->
    <div class="content">
        <div class="tableContainer">
            <table class="layui-table">
                <thead>
                    <tr>
                        <th>门店名称</th>
                        <th>联系人</th>
                        <th>联系人号码</th>
                        <th>门店地址</th>
                        <th>门店位置</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="store_tb">
                    <!-- <tr>
                        <td>华汽总部</td>
                        <td>江苏省公司</td>
                        <td>南京新街口店</td>
                        <td>新华大夏9527层第7区</td>
                        <td>283:303:303</td>
                        <td class="operation">
                            <a id="view" data-method="view">查看</a>
                            <a id="edit" data-method="edit">编辑</a>
                            <a id="isEnable" data-method="isEnable">启用</a>
                        </td>
                    </tr>
                    <tr>
                        <td>华汽总部</td>
                        <td>江苏省公司</td>
                        <td>南京新街口店</td>
                        <td>新华大夏9527层第7区</td>
                        <td>283:303:303</td>
                        <td class="operation">
                            <a id="view" data-method="view">查看</a>
                            <a id="edit" data-method="edit">编辑</a>
                            <a id="isEnable" data-method="isEnable" >启用</a>
                        </td>
                    </tr> -->
                </tbody>
            </table>
            <div id="pages" style="text-align: right;"></div>
        </div>
    </div>
</div>
<!-- 弹框一：门店树状结构 -->
<div id="storeTreeBox" class="storeTreeBox">
    <ul id="storeTree"></ul>
</div>
<!-- 弹框二：询问门店添加位置 -->
<div id="storeLocate" class="storeLocate">
    您当前选中的门店是：<span id="choosedName"></span>
</div>
<!-- 弹框三：门店信息添加与编辑 -->
<div id="storeInfoEdit" class="storeInfo">
    <table class="layui-table ">
        <!-- input框的name值请根据需要自行设置 -->
        <tbody id="editStore">
          <!--   <tr>
                <td>门店名称</td>
                <td><input type="text" name="" class="layui-input" placeholder="请输入门店名称" id ="storeName"></td>
            </tr>
            <tr>
                <td>门店联系人</td>
                <td><input type="text" name="" class="layui-input" placeholder="请输入门店联系人"  id = "userName" onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9-]+/,'');}).call(this)"></td>
            </tr>
            <tr>
                <td>联系人电话</td>
                <td><input type="text" name="" class="layui-input" placeholder="请输入联系人电话" id="mobile"></td>
            </tr>
            <tr>
                    <td>门店地址</td>
                    <td>
                        <div class="layui-input-inline">
                            <select name="prov" id="provinceId" onchange="getCity(this)" class="layui-select">
                            </select>
                        </div>
                        <div class="layui-input-inline">
                            <select name="city" id="cityId" onchange="getCounty(this)" class="layui-select">
                       		 <option value="">请选择市</option>
                    </select>
                        </div>
                        <div class="layui-input-inline">
                           <select name="area" id="countyId" class="layui-select">
                        	<option value="">请选择县/区</option>
                   		 </select>
                        </div>
                        <input type="text" name="" class="layui-input" placeholder="请输入门店地址">
                    </td>
                </tr>
            <tr>
                <td>门店位置</td>
                    <td id="storeUrl">23:393:94</td>
            </tr>
            <tr>
                <td>图片上传</td>
                <td>
                    <input type="file" name="" id="storeImg" class="layui-input" >
                </td>
            </tr>
            <tr>
               <td>是否启用</td>
               <td class="state">
                    单选框的value的值请根据需要重新设置
                    <input type="radio" name="isEnable" value="1" >是
                    <input type="radio" name="isEnable" value="0" >否
                </td>
            </tr> -->
   
    </table>
</div>
<div id="storeInfoView" class="storeInfo">
    <table class="layui-table">
        <!-- input框的name值请根据需要自行设置 -->
        <tbody id="store_view">
            <!-- <tr>
                <td>门店名称</td>
                <td>1</td>
            </tr>
            <tr>
                <td>门店联系人</td>
                <td>2</td>
            </tr>
            <tr>
                <td>联系人电话</td>
                <td>3</td>
            </tr>
            <tr>
                <td>门店地址</td>
                <td>4</td>
            </tr>
            <tr>
                <td>门店位置</td>
                <td>5</td>
            </tr>
            <tr>
                <td>图片</td>
                <td><button id="seePic" class="layui-btn-primary">查看图片</button></td>
            </tr>
            <tr>
                <td>是否启用</td>
                <td>
                    单选框的value的值请根据需要重新设置
                    <input type="radio" name="isEnable" value="yes" title="是" selected>
                    <input type="radio" name="isEnable" value="no" title="否">
                </td>
            </tr> -->
        </tbody>
    </table>
</div>
<!-- 弹框四：门店图片 -->
<div id="storeImage" style="display: none">
    <!-- 为看效果图片路径暂定死，更改后请删除 -->
    <img src="../../images/icon1.jpg" alt="门店图片">
</div>

 <script type="text/javascript">
 
 var pros = findAllProvinces();
 var p = null;
 var provinces = '<option value="">请选择省</option>';
 for(i=0;i<pros.length;i++){
	 p= pros[i];
	 provinces += '<option value="'+p.id+'">'+p.name+'</option>';
 }
 $("#province").html(provinces);
 

 function getCitys(obj){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择市</option>';
 	 for(i=0;i<citys.length;i++){
 		 var  c = citys[i];
 		 ci += '<option value="'+c.id+'">'+c.name+'</option>';
 	 }
 	 $("#city").html(ci);
 }

 function getCountys(obj){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择县</option>';
 	 for(i=0;i<citys.length;i++){
 		var cs = citys[i];
 		 ci += '<option value="'+cs.id+'">'+cs.name+'</option>';
 	 }
 	 $("#county").html(ci);
 }
	
 for(i=0;i<pros.length;i++){
	 p= pros[i];
	 provinces += '<option value="'+p.id+'">'+p.name+'</option>';
 }
 $("#provinceIds").html(provinces);
 

 function getCityIds(obj){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择市</option>';
 	 for(i=0;i<citys.length;i++){
 		 var  c = citys[i];
 		 ci += '<option value="'+c.id+'">'+c.name+'</option>';
 	 }
 	 $("#cityIds").html(ci);
 }

 function getCountyIds(obj){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择县</option>';
 	 for(i=0;i<citys.length;i++){
 		var cs = citys[i];
 		 ci += '<option value="'+cs.id+'">'+cs.name+'</option>';
 	 }
 	 $("#countyIds").html(ci);
 }
 
 
 

 function getCity(obj,isCheckedId){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择市</option>';
 	 for(i=0;i<citys.length;i++){
 		 var  c = citys[i];
 		 if(isCheckedId == c.id){ 
 			 ci += '<option value="'+c.id+'" selected="selected">'+c.name+'</option>';
 		 }else{
 			 ci += '<option value="'+c.id+'">'+c.name+'</option>';
 		 }
 		
 	 }
 	 $("#cityId").html(ci);
 	 getCounty($("#cityId"));
 }

 function getCounty(obj,isCheckedId){
 	var p = $(obj);
 	var pid = p.val();
 	var citys = findChildrenByPid(pid);
 	var ci = '<option value="">请选择县</option>';
 	 for(i=0;i<citys.length;i++){
 		var cs = citys[i];
 		if(isCheckedId == cs.id){
 			ci += '<option value="'+cs.id+'" selected="selected">'+cs.name+'</option>';
 		}else{
 		 ci += '<option value="'+cs.id+'">'+cs.name+'</option>';
 			
 		}
 	 }
 	 $("#countyId").html(ci);
 } 
 
	
	function isEnable(storeId){
		$.ajax({
	    	url : "http://localhost:8881/storeisuseable",
			type : "post",
			data : {"storeId":storeId},
	    	success : function(data){
	    		 window.location.reload();
	    			
	    		}
	    }); 
	}
	
	function getStoreInfo(storeId){
		$.ajax({
	    	url : "http://localhost:8881/getstorebystoreid",
			type : "get",
			data : {"storeId":storeId},
	    	success : function(data){
	    		var result = data.result;
	    		var tb_html="";
	    		var store_view = $("#store_view");
	    		var status = result.isUseable?"是":"否";
	    			tb_html= '<tr><td>门店名称</td><td>'+result.storeName+'</td></tr>'+
	    						'<tr><td>门店联系人</td><td>'+result.userName+'</td></tr>'+
	    						'<tr><td>联系人电话</td><td>'+result.mobile+'</td></tr>'+
	    						'<tr><td>门店地址</td><td>'+result.address+'</td></tr>'+
	    						'<tr><td>门店位置</td><td>('+result.longitude+','+result.latitude+')</td></tr>'+
	    						'<tr><td>图片</td>'+
	    						 '<td><button id="seePic" class="layui-btn-primary"/>查看图片</td></tr>'+
	    						'<tr><td>是否启用</td>'+
	    						'<td>'+status+'</td></tr>'
	    			store_view.html(tb_html);
	    						
	    		}
	    }); 
		
	}
	
	function changeStore(storeId){
		$.ajax({
	    	url : "http://localhost:8881/getstorebystoreid",
			type : "get",
			data : {"storeId":storeId},
	    	success : function(data){
	    		var result = data.result;
	    		var tb_html="";
	    		var editStore = $("#editStore");
	    		var status = result.isUseable?"是":"否";
	    			tb_html= '<tr><td>门店名称</td><td><input type="hidden" value="'+storeId+'" id="storeId"><input value="'+result.storeName+'" id="storeName"></input></td></tr>'+
	    						'<tr><td>门店联系人</td><td><input value="'+result.userName+'" id="userName2"></input></td></tr>'+
	    						'<tr><td>联系人电话</td><td><input value="'+result.mobile+'" id="mobile"></input></td></tr>'+
	    						'<tr><td>门店地址</td><td><div class="layui-input-inline"><select name="prov" id="provinceId" onchange="getCity(this,'+result.cityId+')" class="layui-select"></select></div>'+
	    						'<div class="layui-input-inline"><select name="city" id="cityId" onchange="getCounty(this,'+result.countyId+')" class="layui-select"><option value="">请选择市</option></select></div>'+
	    						' <div class="layui-input-inline"><select name="area" id="countyId" class="layui-select"><option value="">请选择县/区</option></select></div>'+
                 				'<input type="text" name="" class="layui-input" placeholder="请输入门店地址"><input id="address" value="'+result.address+'"></input></td></tr>'+
	    						'<tr><td>门店位置</td><td><input value="('+result.longitude+','+result.latitude+')"></input></td></tr>'+
	    						'<tr><td>图片上传</td><td><input type="file" name="" id="storeImg" class="layui-input"><input id="backUrl" value="'+result.backUrl+'"></input></td></tr>'+
	    						'<tr><td>是否启用</td>'+
	    						'<td>'+status+'</td></tr>'
	    						editStore.html(tb_html);
	    						
 					var pros = findAllProvinces();
 					var p = null;
 					var provinces = '<option value="">请选择省</option>';
 					
	    			for(i=0;i<pros.length;i++){
	    				p= pros[i];
	    				provinces += '<option value="'+p.id+'">'+p.name+'</option>';
	    			 }
	    			 $("#provinceId").html(provinces);
	    			 $("#provinceId").val(result.provinceId);
	    			 getCity($("#provinceId"), result.cityId);
	    			 getCounty($("#cityId"),result.countyId);
	    		}
	    }); 
	}
	
	function updateStore(){
		var dd = $("#userName2").val();
		debugger;
		$.ajax({
			url : "http://localhost:8881/changestorebystoreid",
			type : "post",
			async:false,
			headers:{
				  "Authorization":localStorage.token
				 },
				
			data : {"storeId":$("#storeId").val(),"storeName":$("#storeName").val(),
				    "address":$("#address").val(),"provinceId":$("#provinceId").val(),
				    "cityId":$("#cityId").val(),"countyId":$("#countyId").val(),
				    "mobile":$("#mobile").val(),"backUrl":$("#backUrl").val(),
				    "userName":$("#userName2").val()},
	    	success : function(data){
	    		if(0 == data.errcode){
	    			alert("编辑成功！");
	    			$("#storeName").val("");
	    		}
	    		
	    	}
			
			
		});
		
	}
	  
	
	
	
</script> 
<script src="BasicInformation/StoreManage/StoreManage.js"></script>